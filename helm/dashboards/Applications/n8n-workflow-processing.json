{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":null,"links":[{"asDropdown":false,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":[],"targetBlank":false,"title":"Back to Overview","type":"link","url":"/d/infrastructure-overview"}],"liveNow":false,"panels":[{"type":"row","title":"Application Health - Node.js & Workers","collapsed":false,"gridPos":{"x":0,"y":0,"w":24,"h":1},"id":102},{"type":"stat","pluginVersion":"10.0.0","title":"Bull Queue - Jobs Waiting","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":10},{"color":"red","value":50}],"mode":"absolute"}}},"targets":[{"expr":"max(n8n_scaling_mode_queue_jobs_waiting{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":0,"w":6,"y":14,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Workflow jobs waiting in Bull queue (Redis-backed)","id":1},{"type":"stat","pluginVersion":"10.0.0","title":"Bull Queue - Jobs Active","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":5},{"color":"red","value":10}],"mode":"absolute"}}},"targets":[{"expr":"max(n8n_scaling_mode_queue_jobs_active{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":6,"w":6,"y":14,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Workflow jobs currently being processed","id":2},{"type":"stat","pluginVersion":"10.0.0","title":"Bull Queue - Completion Rate","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"ops","decimals":2,"mappings":[],"thresholds":{"steps":[{"color":"red","value":null},{"color":"yellow","value":0.1},{"color":"green","value":1}],"mode":"absolute"}}},"targets":[{"expr":"sum(rate(n8n_scaling_mode_queue_jobs_completed{namespace=\"$namespace\"}[5m]))","refId":"A","legendFormat":""}],"gridPos":{"x":12,"w":6,"y":14,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Jobs completed per second (5m average)","id":3},{"type":"stat","pluginVersion":"10.0.0","title":"Bull Queue - Failure Rate","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"ops","decimals":2,"mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":0.01},{"color":"red","value":0.1}],"mode":"absolute"}}},"targets":[{"expr":"sum(rate(n8n_scaling_mode_queue_jobs_failed{namespace=\"$namespace\"}[5m]))","refId":"A","legendFormat":""}],"gridPos":{"x":18,"w":6,"y":14,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Jobs failed per second (5m average)","id":4},{"type":"timeseries","pluginVersion":"10.0.0","title":"Bull Queue - Job Flow (Waiting vs Active vs Processing Rate)","fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineInterpolation":"smooth","barAlignment":0,"lineWidth":2,"fillOpacity":20,"gradientMode":"opacity","spanNulls":false,"showPoints":"never","pointSize":5,"stacking":{"mode":"none","group":"A"},"axisPlacement":"auto","axisLabel":"","scaleDistribution":{"type":"linear"},"hideFrom":{"tooltip":false,"viz":false,"legend":false},"thresholdsStyle":{"mode":"off"}},"color":{"mode":"palette-classic"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Waiting"},"properties":[{"id":"color","value":{"fixedColor":"orange","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"Active"},"properties":[{"id":"color","value":{"fixedColor":"blue","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"Completed/sec"},"properties":[{"id":"color","value":{"fixedColor":"green","mode":"fixed"}},{"id":"custom.axisPlacement","value":"right"}]}]},"options":{"tooltip":{"mode":"multi","sort":"none"},"legend":{"showLegend":true,"displayMode":"table","placement":"bottom","calcs":["lastNotNull","mean"]}},"targets":[{"expr":"max(n8n_scaling_mode_queue_jobs_waiting{namespace=\"$namespace\"})","refId":"A","legendFormat":"Waiting"},{"expr":"max(n8n_scaling_mode_queue_jobs_active{namespace=\"$namespace\"})","refId":"B","legendFormat":"Active"},{"expr":"sum(rate(n8n_scaling_mode_queue_jobs_completed{namespace=\"$namespace\"}[5m]))","refId":"C","legendFormat":"Completed/sec"}],"gridPos":{"x":0,"w":24,"y":18,"h":8},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Bull queue job flow - if waiting jobs increase while completion rate is flat, queue is falling behind","id":5},{"type":"row","title":"RabbitMQ - Message Broker","collapsed":false,"gridPos":{"x":0,"y":26,"w":24,"h":1},"id":101},{"type":"stat","pluginVersion":"10.0.0","title":"RabbitMQ - Total Queue Depth","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":100},{"color":"red","value":500}],"mode":"absolute"}}},"targets":[{"expr":"sum(rabbitmq_queue_messages{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":0,"w":6,"y":27,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Total messages across all RabbitMQ queues","id":6},{"type":"stat","pluginVersion":"10.0.0","title":"RabbitMQ - Messages Ready","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":50},{"color":"red","value":200}],"mode":"absolute"}}},"targets":[{"expr":"sum(rabbitmq_queue_messages_ready{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":6,"w":6,"y":27,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Messages waiting to be consumed","id":7},{"type":"stat","pluginVersion":"10.0.0","title":"RabbitMQ - Active Consumers","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"red","value":null},{"color":"yellow","value":1},{"color":"green","value":2}],"mode":"absolute"}}},"targets":[{"expr":"sum(rabbitmq_queue_consumers{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":12,"w":6,"y":27,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"none","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Total active consumers across all queues","id":8},{"type":"stat","pluginVersion":"10.0.0","title":"RabbitMQ - Consumer Utilization","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"percentunit","decimals":1,"mappings":[],"thresholds":{"steps":[{"color":"red","value":null},{"color":"yellow","value":0.5},{"color":"green","value":0.8}],"mode":"absolute"}}},"targets":[{"expr":"avg(rabbitmq_queue_consumer_utilisation{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":18,"w":6,"y":27,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Average consumer utilization (0-1) - low values indicate consumers can't keep up","id":9},{"type":"timeseries","pluginVersion":"10.0.0","title":"RabbitMQ - Messages Per Queue","fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineInterpolation":"linear","barAlignment":0,"lineWidth":1,"fillOpacity":10,"gradientMode":"none","spanNulls":false,"showPoints":"never","pointSize":5,"stacking":{"mode":"none","group":"A"},"axisPlacement":"auto","axisLabel":"","scaleDistribution":{"type":"linear"},"hideFrom":{"tooltip":false,"viz":false,"legend":false},"thresholdsStyle":{"mode":"off"}},"color":{"mode":"palette-classic"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"options":{"tooltip":{"mode":"multi","sort":"none"},"legend":{"showLegend":true,"displayMode":"table","placement":"bottom","calcs":["lastNotNull","max"]}},"targets":[{"expr":"rabbitmq_queue_messages{namespace=\"$namespace\"}","refId":"A","legendFormat":"{{queue}}"}],"gridPos":{"x":0,"w":12,"y":31,"h":8},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Total messages per RabbitMQ queue","id":10},{"type":"timeseries","pluginVersion":"10.0.0","title":"RabbitMQ - Messages Ready vs Unacked Per Queue","fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineInterpolation":"linear","barAlignment":0,"lineWidth":1,"fillOpacity":10,"gradientMode":"none","spanNulls":false,"showPoints":"never","pointSize":5,"stacking":{"mode":"normal","group":"A"},"axisPlacement":"auto","axisLabel":"","scaleDistribution":{"type":"linear"},"hideFrom":{"tooltip":false,"viz":false,"legend":false},"thresholdsStyle":{"mode":"off"}},"color":{"mode":"palette-classic"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[{"matcher":{"id":"byRegexp","options":".*Ready.*"},"properties":[{"id":"color","value":{"fixedColor":"yellow","mode":"fixed"}}]},{"matcher":{"id":"byRegexp","options":".*Unacked.*"},"properties":[{"id":"color","value":{"fixedColor":"blue","mode":"fixed"}}]}]},"options":{"tooltip":{"mode":"multi","sort":"none"},"legend":{"showLegend":true,"displayMode":"table","placement":"bottom","calcs":["lastNotNull"]}},"targets":[{"expr":"rabbitmq_queue_messages_ready{namespace=\"$namespace\"}","refId":"A","legendFormat":"{{queue}} - Ready"},{"expr":"rabbitmq_queue_messages_unacked{namespace=\"$namespace\"}","refId":"B","legendFormat":"{{queue}} - Unacked"}],"gridPos":{"x":12,"w":12,"y":31,"h":8},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Messages ready (waiting) vs unacked (being processed) per queue","id":11},{"type":"row","title":"Bull Queue (Redis) - Workflow Job Processing","collapsed":false,"gridPos":{"x":0,"y":13,"w":24,"h":1},"id":100},{"type":"stat","pluginVersion":"10.0.0","title":"Active Workflows","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":5},{"color":"red","value":20}],"mode":"absolute"}}},"targets":[{"expr":"max(n8n_active_workflow_count{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":0,"w":6,"y":1,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"none","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Total number of active workflows","id":12},{"type":"stat","pluginVersion":"10.0.0","title":"Worker Count","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"short","mappings":[],"thresholds":{"steps":[{"color":"red","value":null},{"color":"yellow","value":1},{"color":"green","value":2}],"mode":"absolute"}}},"targets":[{"expr":"count(n8n_process_start_time_seconds{namespace=\"$namespace\",pod=~\".*worker.*\"})","refId":"A","legendFormat":""}],"gridPos":{"x":6,"w":6,"y":1,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"none","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Number of n8n worker pods","id":13},{"type":"stat","pluginVersion":"10.0.0","title":"Event Loop Lag (P99)","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"unit":"s","decimals":3,"mappings":[],"thresholds":{"steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":0.5}],"mode":"absolute"}}},"targets":[{"expr":"max(n8n_nodejs_eventloop_lag_p99_seconds{namespace=\"$namespace\"})","refId":"A","legendFormat":""}],"gridPos":{"x":12,"w":6,"y":1,"h":4},"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"justifyMode":"center","graphMode":"area","textMode":"value","colorMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"99th percentile event loop lag - critical for Node.js performance","id":14},{"type":"table","pluginVersion":"10.0.0","title":"Memory Usage Per Pod","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","cellOptions":{"type":"auto"},"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.7},{"color":"red","value":0.9}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Used"},"properties":[{"id":"unit","value":"bytes"},{"id":"decimals","value":0}]},{"matcher":{"id":"byName","options":"Limit"},"properties":[{"id":"unit","value":"bytes"},{"id":"decimals","value":0}]},{"matcher":{"id":"byName","options":"Usage %"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.cellOptions","value":{"type":"color-background"}},{"id":"decimals","value":1}]}]},"targets":[{"expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"n8n.*\", container!=\"\", container!=\"POD\"}) by (pod)","refId":"A","legendFormat":"{{pod}}","format":"table","instant":true},{"expr":"sum(kube_pod_container_resource_limits{namespace=\"$namespace\", pod=~\"n8n.*\", resource=\"memory\", unit=\"byte\"}) by (pod)","refId":"B","legendFormat":"{{pod}}","format":"table","instant":true},{"expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"n8n.*\", container!=\"\", container!=\"POD\"}) by (pod) / sum(kube_pod_container_resource_limits{namespace=\"$namespace\", pod=~\"n8n.*\", resource=\"memory\", unit=\"byte\"}) by (pod)","refId":"C","legendFormat":"{{pod}}","format":"table","instant":true}],"transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"pod":0,"Value #A":1,"Value #B":2,"Value #C":3},"renameByName":{"pod":"Pod","Value #A":"Used","Value #B":"Limit","Value #C":"Usage %"}}}],"gridPos":{"x":0,"w":24,"y":5,"h":7},"options":{"showHeader":true,"cellHeight":"sm","footer":{"show":false,"reducer":["sum"],"fields":""}},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Container memory usage vs Kubernetes limits per pod - shows actual memory pressure","id":15},{"type":"timeseries","pluginVersion":"10.0.0","title":"Memory Usage (Heap) Per Pod","fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineInterpolation":"linear","barAlignment":0,"lineWidth":1,"fillOpacity":10,"gradientMode":"none","spanNulls":false,"showPoints":"never","pointSize":5,"stacking":{"mode":"none","group":"A"},"axisPlacement":"auto","axisLabel":"","scaleDistribution":{"type":"linear"},"hideFrom":{"tooltip":false,"viz":false,"legend":false},"thresholdsStyle":{"mode":"off"}},"color":{"mode":"palette-classic"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"options":{"tooltip":{"mode":"multi","sort":"none"},"legend":{"showLegend":true,"displayMode":"table","placement":"bottom","calcs":["lastNotNull","max"]}},"targets":[{"expr":"n8n_nodejs_heap_size_used_bytes{namespace=\"$namespace\"}","refId":"A","legendFormat":"{{pod}} - Used"},{"expr":"n8n_nodejs_heap_size_total_bytes{namespace=\"$namespace\"}","refId":"B","legendFormat":"{{pod}} - Total"}],"gridPos":{"x":0,"w":12,"y":31,"h":8},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Node.js heap memory usage per pod","id":16},{"type":"timeseries","pluginVersion":"10.0.0","title":"Event Loop Lag (P99) Per Pod","fieldConfig":{"defaults":{"custom":{"drawStyle":"line","lineInterpolation":"smooth","barAlignment":0,"lineWidth":2,"fillOpacity":20,"gradientMode":"opacity","spanNulls":false,"showPoints":"never","pointSize":5,"stacking":{"mode":"none","group":"A"},"axisPlacement":"auto","axisLabel":"","scaleDistribution":{"type":"linear"},"hideFrom":{"tooltip":false,"viz":false,"legend":false},"thresholdsStyle":{"mode":"line"}},"color":{"mode":"palette-classic"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":0.5}]},"unit":"s","decimals":3},"overrides":[]},"options":{"tooltip":{"mode":"multi","sort":"none"},"legend":{"showLegend":true,"displayMode":"table","placement":"bottom","calcs":["lastNotNull","max"]}},"targets":[{"expr":"n8n_nodejs_eventloop_lag_p99_seconds{namespace=\"$namespace\"}","refId":"A","legendFormat":"{{pod}}"}],"gridPos":{"x":12,"w":12,"y":31,"h":8},"datasource":{"type":"prometheus","uid":"prometheus"},"description":"99th percentile event loop lag per pod - values >100ms indicate performance issues","id":17}],"refresh":"30s","schemaVersion":38,"style":"dark","tags":["n8n","workflow","bull-queue","rabbitmq","copperiq"],"templating":{"list":[{"current":{"selected":false,"text":"n8n-dev","value":"n8n-dev"},"description":"Select n8n environment","hide":0,"includeAll":false,"label":"Environment","multi":false,"name":"namespace","options":[{"selected":true,"text":"n8n-dev","value":"n8n-dev"},{"selected":false,"text":"n8n-prod","value":"n8n-prod"}],"query":"n8n-dev,n8n-prod","queryValue":"","skipUrlSync":false,"type":"custom"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["10s","30s","1m","5m","15m","30m","1h"]},"timezone":"Europe/Amsterdam","title":"n8n - Workflow Processing","uid":"n8n-workflow-processing","version":1,"weekStart":"","folderUid":"applications","meta":{"folderTitle":"Applications"}}