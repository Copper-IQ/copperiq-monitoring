{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":null,"links":[{"asDropdown":false,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":[],"targetBlank":false,"title":"Back to Overview","type":"link","url":"/d/infrastructure-overview"},{"asDropdown":false,"icon":"external link","includeVars":true,"keepTime":true,"tags":[],"targetBlank":true,"title":"RabbitMQ Dashboard","type":"link","url":"/d/rabbitmq"}],"liveNow":false,"panels":[{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Content Platform environment availability","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"color":"red","index":0,"text":"DOWN"},"1":{"color":"green","index":1,"text":"UP"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}}},"gridPos":{"y":0,"h":4,"w":6,"x":0},"id":1,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"10.0.0","targets":[{"expr":"min(kube_deployment_status_replicas_available{namespace=\"$namespace\"})","refId":"A"}],"title":"Environment","type":"stat"},{"gridPos":{"y":0,"h":4,"w":6,"x":6},"title":"Active Pods","type":"stat","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":3}]}}},"description":"Total running pods in namespace","id":30,"targets":[{"expr":"count(kube_pod_info{namespace=\"$namespace\", pod=~\"web-.*|websocket-.*|redis-.*|content-platform-domain-controller-.*\"})","refId":"A"}],"options":{"colorMode":"background","graphMode":"none","textMode":"value"},"datasource":{"type":"prometheus","uid":"prometheus"}},{"collapsed":false,"id":100,"gridPos":{"y":4,"h":1,"w":24,"x":0},"title":"Web Service (Next.js)","type":"row"},{"gridPos":{"y":5,"h":8,"w":8,"x":0},"title":"CPU Usage","type":"timeseries","fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2,"fillOpacity":20,"drawStyle":"line"},"unit":"percentunit","color":{"mode":"palette-classic"}}},"description":"CPU usage rate per pod","id":22,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"web-.*\", container!=\"\", container!=\"POD\"}[5m])) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["mean","max"],"displayMode":"table"}},"datasource":{"type":"prometheus","uid":"prometheus"}},{"gridPos":{"y":5,"h":8,"w":8,"x":8},"title":"Heap Memory","type":"timeseries","fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2,"fillOpacity":10,"drawStyle":"line","axisPlacement":"auto"},"unit":"bytes","color":{"mode":"palette-classic"}}},"description":"Node.js heap memory usage - process resident memory","id":21,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"process_resident_memory_bytes{namespace=\"$namespace\", pod=~\"web-.*\"}"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"datasource":{"type":"prometheus","uid":"prometheus"}},{"gridPos":{"y":5,"h":8,"w":8,"x":16},"title":"Event Loop Lag","type":"timeseries","fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2},"unit":"s","color":{"mode":"palette-classic"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":0.5}]}}},"description":"Node.js event loop lag - high values indicate blocking operations","id":23,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"nodejs_eventloop_lag_seconds{namespace=\"$namespace\", pod=~\"web-.*\"}"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"datasource":{"type":"prometheus","uid":"prometheus"}},{"collapsed":false,"id":101,"gridPos":{"y":13,"h":1,"w":24,"x":0},"title":"Websocket Service (Socket.io)","type":"row"},{"gridPos":{"y":14,"h":8,"w":8,"x":0},"fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2,"fillOpacity":20,"drawStyle":"line"},"unit":"percentunit","color":{"mode":"palette-classic"}}},"id":40,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"websocket-.*\", container!=\"\", container!=\"POD\"}[5m])) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["mean","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"CPU Usage"},{"gridPos":{"y":14,"h":8,"w":8,"x":8},"fieldConfig":{"defaults":{"custom":{"fillOpacity":10,"lineWidth":2},"unit":"bytes","color":{"mode":"palette-classic"}}},"id":41,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"process_resident_memory_bytes{namespace=\"$namespace\", pod=~\"websocket-.*\"}"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"Heap Memory"},{"gridPos":{"y":14,"h":8,"w":8,"x":16},"fieldConfig":{"defaults":{"custom":{"lineWidth":2},"unit":"s","color":{"mode":"palette-classic"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":0.5}]}}},"id":42,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"nodejs_eventloop_lag_seconds{namespace=\"$namespace\", pod=~\"websocket-.*\"}"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"Event Loop Lag"},{"collapsed":false,"id":102,"gridPos":{"y":22,"h":1,"w":24,"x":0},"title":"Redis (Cache & Sessions)","type":"row"},{"gridPos":{"y":23,"h":8,"w":8,"x":0},"fieldConfig":{"defaults":{"custom":{"fillOpacity":10,"lineWidth":2},"unit":"bytes","color":{"mode":"palette-classic"}}},"id":50,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"redis-.*\", container!=\"\", container!=\"POD\"}) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"Memory Usage"},{"gridPos":{"y":23,"h":8,"w":8,"x":8},"fieldConfig":{"defaults":{"custom":{"fillOpacity":20,"lineWidth":2},"unit":"percentunit","color":{"mode":"palette-classic"}}},"id":51,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"redis-.*\", container!=\"\", container!=\"POD\"}[5m])) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["mean","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"CPU Usage"},{"gridPos":{"y":23,"h":8,"w":8,"x":16},"title":"Connected Clients","type":"stat","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":50},{"color":"red","value":100}]}}},"description":"Requires redis_exporter sidecar (future)","id":52,"targets":[{"expr":"redis_connected_clients{namespace=\"$namespace\"}","refId":"A"}],"options":{"textMode":"value","colorMode":"background"},"datasource":{"type":"prometheus","uid":"prometheus"}},{"collapsed":false,"id":103,"gridPos":{"y":31,"h":1,"w":24,"x":0},"title":"Domain Controller (Go/Kubernetes Controller)","type":"row"},{"gridPos":{"y":32,"h":4,"w":6,"x":0},"fieldConfig":{"defaults":{"mappings":[{"type":"value","options":{"1":{"text":"UP","color":"green","index":1},"0":{"text":"DOWN","color":"red","index":0}}}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]},"color":{"mode":"thresholds"}}},"id":60,"targets":[{"expr":"kube_deployment_status_replicas_available{namespace=\"$namespace\", deployment=~\"content-platform-domain-controller.*\"}","refId":"A"}],"options":{"textMode":"value","colorMode":"background"},"type":"stat","datasource":{"type":"prometheus","uid":"prometheus"},"title":"Controller Status"},{"gridPos":{"y":36,"h":8,"w":9,"x":0},"fieldConfig":{"defaults":{"custom":{"fillOpacity":10,"lineWidth":2},"unit":"bytes","color":{"mode":"palette-classic"}}},"id":61,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"content-platform-domain-controller.*\", container!=\"\", container!=\"POD\"}) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"Memory Usage"},{"gridPos":{"y":36,"h":8,"w":9,"x":9},"fieldConfig":{"defaults":{"custom":{"fillOpacity":20,"lineWidth":2},"unit":"percentunit","color":{"mode":"palette-classic"}}},"id":62,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"content-platform-domain-controller.*\", container!=\"\", container!=\"POD\"}[5m])) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["mean","max"],"displayMode":"table"}},"type":"timeseries","datasource":{"type":"prometheus","uid":"prometheus"},"title":"CPU Usage"},{"gridPos":{"y":36,"h":8,"w":6,"x":18},"title":"Pod Restarts (24h)","type":"stat","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":5}]}}},"description":"Controller pod restarts in last 24 hours","id":63,"targets":[{"expr":"sum(increase(kube_pod_container_status_restarts_total{namespace=\"$namespace\", pod=~\"content-platform-domain-controller.*\"}[24h]))","refId":"A"}],"options":{"textMode":"value","colorMode":"background"},"datasource":{"type":"prometheus","uid":"prometheus"}}],"refresh":"30s","schemaVersion":38,"style":"dark","tags":["copperiq","content-platform","n8n"],"templating":{"list":[{"queryValue":"","multi":false,"type":"custom","label":"Environment","description":"Select Content Platform environment","options":[{"value":"content-platform-accept","text":"content-platform-accept","selected":true},{"value":"content-platform-prod","text":"content-platform-prod","selected":false}],"includeAll":false,"query":"content-platform-accept,content-platform-prod","skipUrlSync":false,"name":"namespace","hide":0,"current":{"value":"content-platform-accept","text":"content-platform-accept","selected":false}},{"current":{"selected":false,"text":"Prometheus","value":"Prometheus"},"hide":0,"includeAll":false,"label":"Datasource","multi":false,"name":"DS_PROMETHEUS","options":[],"query":"prometheus","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"Europe/Amsterdam","title":"Content Platform","uid":"content-platform","version":1,"weekStart":"monday","folderUid":"applications","meta":{"folderTitle":"Content Platform"}}