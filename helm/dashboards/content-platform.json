{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":null,"links":[{"asDropdown":false,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":[],"targetBlank":false,"title":"Back to Overview","type":"link","url":"/d/infrastructure-overview"},{"asDropdown":false,"icon":"external link","includeVars":true,"keepTime":true,"tags":[],"targetBlank":true,"title":"RabbitMQ Dashboard","type":"link","url":"/d/rabbitmq"}],"liveNow":false,"panels":[{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Content Platform environment availability","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"color":"red","index":0,"text":"DOWN"},"1":{"color":"green","index":1,"text":"UP"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}}},"gridPos":{"h":4,"w":6,"x":0,"y":0},"id":1,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"10.0.0","targets":[{"expr":"min(kube_deployment_status_replicas_available{namespace=\"$namespace\"})","refId":"A"}],"title":"Environment Status","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"n8n Dev worker availability","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"color":"red","index":0,"text":"DOWN"},"1":{"color":"green","index":1,"text":"UP"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}}},"gridPos":{"h":4,"w":6,"x":6,"y":0},"id":3,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"10.0.0","targets":[{"expr":"kube_deployment_status_replicas_available{namespace=\"n8n-dev\",deployment=\"n8n-worker\"}","refId":"A"}],"title":"n8n Dev Worker","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"n8n Prod worker availability","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"color":"red","index":0,"text":"DOWN"},"1":{"color":"green","index":1,"text":"UP"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}}},"gridPos":{"h":4,"w":6,"x":12,"y":0},"id":4,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"10.0.0","targets":[{"expr":"kube_deployment_status_replicas_available{namespace=\"n8n-prod\",deployment=\"n8n-worker\"}","refId":"A"}],"title":"n8n Prod Worker","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Queue depth comparison: Dev (warning >200) vs Prod (warning >500, critical >1000)","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Messages","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","hideFrom":{"tooltip":false,"viz":false,"legend":false},"lineInterpolation":"linear","lineWidth":2,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":200},{"color":"orange","value":500},{"color":"red","value":1000}]},"unit":"short"}},"gridPos":{"h":8,"w":12,"x":0,"y":4},"id":5,"options":{"legend":{"calcs":["lastNotNull","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"10.0.0","targets":[{"expr":"sum(rabbitmq_queue_messages{namespace=\"n8n-dev\"})","legendFormat":"Dev Queue","refId":"A"},{"expr":"sum(rabbitmq_queue_messages{namespace=\"n8n-prod\"})","legendFormat":"Prod Queue","refId":"B"}],"title":"Queue Depth: Dev vs Prod (Business Growth Indicator)","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Consumer count by environment","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Consumers","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","hideFrom":{"tooltip":false,"viz":false,"legend":false},"lineInterpolation":"linear","lineWidth":2,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"}},"gridPos":{"h":8,"w":12,"x":12,"y":4},"id":6,"options":{"legend":{"calcs":["lastNotNull","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"10.0.0","targets":[{"expr":"sum(rabbitmq_queue_consumers{namespace=\"n8n-dev\"})","legendFormat":"Dev Consumers","refId":"A"},{"expr":"sum(rabbitmq_queue_consumers{namespace=\"n8n-prod\"})","legendFormat":"Prod Consumers","refId":"B"}],"title":"Active Consumers","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Oldest message age in queues (indicates backlog processing time)","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"tooltip":false,"viz":false,"legend":false},"lineInterpolation":"linear","lineWidth":2,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":300},{"color":"red","value":600}]},"unit":"s"}},"gridPos":{"h":8,"w":12,"x":0,"y":12},"id":7,"options":{"legend":{"calcs":["lastNotNull","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"10.0.0","targets":[{"expr":"rabbitmq_queue_head_message_timestamp{namespace=\"n8n-dev\"} - time()","legendFormat":"Dev - {{queue}}","refId":"A"},{"expr":"rabbitmq_queue_head_message_timestamp{namespace=\"n8n-prod\"} - time()","legendFormat":"Prod - {{queue}}","refId":"B"}],"title":"Oldest Message Age (Backlog Indicator)","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Message flow rates: publish and deliver rates","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Messages/sec","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"tooltip":false,"viz":false,"legend":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"msgs/s"}},"gridPos":{"h":8,"w":12,"x":12,"y":12},"id":8,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"10.0.0","targets":[{"expr":"rate(rabbitmq_channel_messages_published_total{namespace=\"n8n-prod\"}[5m])","legendFormat":"Prod Publish Rate","refId":"A"},{"expr":"rate(rabbitmq_channel_messages_delivered_total{namespace=\"n8n-prod\"}[5m])","legendFormat":"Prod Deliver Rate","refId":"B"},{"expr":"rate(rabbitmq_channel_messages_published_total{namespace=\"n8n-dev\"}[5m])","legendFormat":"Dev Publish Rate","refId":"C"},{"expr":"rate(rabbitmq_channel_messages_delivered_total{namespace=\"n8n-dev\"}[5m])","legendFormat":"Dev Deliver Rate","refId":"D"}],"title":"Message Flow Rates","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"HTTP traffic by domain (requires ingress-nginx metrics)","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"Requests/sec","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"tooltip":false,"viz":false,"legend":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"reqps"}},"gridPos":{"h":8,"w":12,"x":0,"y":20},"id":9,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"10.0.0","targets":[{"expr":"rate(nginx_ingress_controller_requests{host=\"content.accept.copperiq.com\"}[5m])","legendFormat":"content.accept (Dev)","refId":"A"},{"expr":"rate(nginx_ingress_controller_requests{host=\"marketing.copperiq.com\"}[5m])","legendFormat":"marketing (Prod)","refId":"B"},{"expr":"rate(nginx_ingress_controller_requests{host=\"n8n.accept.copperiq.com\"}[5m])","legendFormat":"n8n.accept (Dev)","refId":"C"},{"expr":"rate(nginx_ingress_controller_requests{host=\"n8n.copperiq.com\"}[5m])","legendFormat":"n8n (Prod)","refId":"D"}],"title":"Traffic by Domain","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"CPU usage for all pods in selected environment","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"tooltip":false,"viz":false,"legend":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"percent"}},"gridPos":{"h":8,"w":12,"x":12,"y":20},"id":10,"options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"pluginVersion":"10.0.0","targets":[{"expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\",container!=\"POD\",container!=\"\"}[5m])) by (pod) * 100","legendFormat":"{{namespace}}/{{pod}}","refId":"A"}],"title":"Pod CPU Usage (All Containers)","type":"timeseries"},{"gridPos":{"y":25,"h":7,"w":24,"x":0},"title":"Memory Usage Per Pod","type":"table","fieldConfig":{"defaults":{"mappings":[],"custom":{"inspect":false,"align":"auto","cellOptions":{"type":"auto"}},"unit":"short","color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.7},{"color":"red","value":0.9}]}},"overrides":[{"matcher":{"id":"byName","options":"Used"},"properties":[{"value":"bytes","id":"unit"},{"value":0,"id":"decimals"}]},{"matcher":{"id":"byName","options":"Limit"},"properties":[{"value":"bytes","id":"unit"},{"value":0,"id":"decimals"}]},{"matcher":{"id":"byName","options":"Usage %"},"properties":[{"value":"percentunit","id":"unit"},{"value":{"type":"color-background"},"id":"custom.cellOptions"},{"value":1,"id":"decimals"}]}]},"description":"Container memory usage vs Kubernetes limits per pod - shows actual memory pressure","id":20,"targets":[{"refId":"A","legendFormat":"{{pod}}","format":"table","expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"content-platform-web.*\", container!=\"\", container!=\"POD\"}) by (pod)","instant":true},{"refId":"B","legendFormat":"{{pod}}","format":"table","expr":"sum(kube_pod_container_resource_limits{namespace=\"$namespace\", pod=~\"content-platform-web.*\", resource=\"memory\", unit=\"byte\"}) by (pod)","instant":true},{"refId":"C","legendFormat":"{{pod}}","format":"table","expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"content-platform-web.*\", container!=\"\", container!=\"POD\"}) by (pod) / sum(kube_pod_container_resource_limits{namespace=\"$namespace\", pod=~\"content-platform-web.*\", resource=\"memory\", unit=\"byte\"}) by (pod)","instant":true}],"transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"indexByName":{"pod":0,"Value #C":3,"Value #B":2,"Value #A":1},"renameByName":{"pod":"Pod","Value #C":"Usage %","Value #B":"Limit","Value #A":"Used"},"excludeByName":{"Time":true}}}],"options":{"showHeader":true,"cellHeight":"sm","footer":{"reducer":["sum"],"show":false,"fields":""}},"datasource":{"type":"prometheus","uid":"prometheus"}},{"gridPos":{"y":32,"h":8,"w":12,"x":0},"title":"Memory Usage (Heap) Per Pod","type":"timeseries","fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2,"fillOpacity":10,"drawStyle":"line","axisPlacement":"auto"},"unit":"bytes","color":{"mode":"palette-classic"}}},"description":"Node.js heap memory usage - process resident memory","id":21,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"process_resident_memory_bytes{namespace=\"$namespace\", pod=~\"content-platform-web.*\"}"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"datasource":{"type":"prometheus","uid":"prometheus"}},{"gridPos":{"y":32,"h":8,"w":12,"x":12},"title":"CPU Usage Per Pod","type":"timeseries","fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2,"fillOpacity":20,"drawStyle":"line"},"unit":"percentunit","color":{"mode":"palette-classic"}}},"description":"CPU usage rate per pod","id":22,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"content-platform-web.*\", container!=\"\", container!=\"POD\"}[5m])) by (pod)"}],"options":{"legend":{"placement":"bottom","calcs":["mean","max"],"displayMode":"table"}},"datasource":{"type":"prometheus","uid":"prometheus"}},{"gridPos":{"y":40,"h":8,"w":12,"x":0},"title":"Event Loop Lag","type":"timeseries","fieldConfig":{"defaults":{"custom":{"showPoints":"never","lineWidth":2},"unit":"s","color":{"mode":"palette-classic"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":0.5}]}}},"description":"Node.js event loop lag - high values indicate blocking operations","id":23,"targets":[{"refId":"A","legendFormat":"{{pod}}","expr":"nodejs_eventloop_lag_seconds{namespace=\"$namespace\"}"}],"options":{"legend":{"placement":"bottom","calcs":["last","max"],"displayMode":"table"}},"datasource":{"type":"prometheus","uid":"prometheus"}}],"refresh":"30s","schemaVersion":38,"style":"dark","tags":["copperiq","content-platform","n8n"],"templating":{"list":[{"queryValue":"","multi":false,"type":"custom","label":"Environment","description":"Select Content Platform environment","options":[{"value":"content-platform-accept","text":"content-platform-accept","selected":true},{"value":"content-platform-prod","text":"content-platform-prod","selected":false}],"includeAll":false,"query":"content-platform-accept,content-platform-prod","skipUrlSync":false,"name":"namespace","hide":0,"current":{"value":"content-platform-accept","text":"content-platform-accept","selected":false}},{"current":{"selected":false,"text":"Prometheus","value":"Prometheus"},"hide":0,"includeAll":false,"label":"Datasource","multi":false,"name":"DS_PROMETHEUS","options":[],"query":"prometheus","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"Europe/Amsterdam","title":"Content Platform","uid":"content-platform","version":1,"weekStart":"monday","folderUid":"applications","meta":{"folderTitle":"Content Platform"}}