# Grafana Unified Alerting Rules: argocd
# Converted from PrometheusRule: argocd-alerts
apiVersion: 1
groups:
  - orgId: 1
    name: argocd
    folder: applications
    interval: 30s
    rules:
      - uid: argocdappnotsynced
        title: ArgoCDAppNotSynced
        condition: C
        for: 10m
        noDataState: OK
        execErrState: Alerting
        annotations:
          summary: ArgoCD app {{ $labels.name }} not synced
          description: |
            Application {{ $labels.name }} in {{ $labels.namespace }} is out of sync.

            **Sync status**: {{ $labels.sync_status }}
            **Health status**: {{ $labels.health_status }}

            **Impact**: GitOps workflow broken, changes not deployed.

            **Action**:
            1. Check app status: `argocd app get {{ $labels.name }}`
            2. View sync errors: `argocd app get {{ $labels.name }} --show-operation`
            3. Manual sync if needed: `argocd app sync {{ $labels.name }}`
            4. Check ArgoCD UI: https://argocd.accept.copperiq.com
        labels:
          severity: warning
          component: argocd
          category: platform
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: argocd_app_info{sync_status!="Synced"}
              refId: A
              datasource:
                type: prometheus
                uid: prometheus
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: B
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
              datasource:
                type: __expr__
                uid: __expr__
          - refId: C
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: math
              expression: $B > 0
              refId: C
              datasource:
                type: __expr__
                uid: __expr__
      - uid: argocdsyncfailure
        title: ArgoCDSyncFailure
        condition: C
        for: 5m
        noDataState: OK
        execErrState: Alerting
        annotations:
          summary: ArgoCD sync failure for {{ $labels.name }}
          description: |
            Application {{ $labels.name }} failed to sync in the last 5 minutes.

            **Impact**: Deployment blocked, updates not applied.

            **Action**:
            1. Check sync errors: `argocd app get {{ $labels.name }}`
            2. View application events: `kubectl get events -n {{ $labels.dest_namespace }} --sort-by='.lastTimestamp'`
            3. Check for resource conflicts or validation errors
            4. Review recent commits in source repository
        labels:
          severity: warning
          component: argocd
          category: platform
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: increase(argocd_app_sync_total{phase="Failed"}[5m])
              refId: A
              datasource:
                type: prometheus
                uid: prometheus
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: B
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
              datasource:
                type: __expr__
                uid: __expr__
          - refId: C
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: math
              expression: $B > 0
              refId: C
              datasource:
                type: __expr__
                uid: __expr__
      - uid: argocdserverdown
        title: ArgoCDServerDown
        condition: C
        for: 2m
        noDataState: OK
        execErrState: Alerting
        annotations:
          summary: ArgoCD server is down
          description: |
            ArgoCD API server is not responding.

            **Impact**: 
            - ArgoCD UI unavailable
            - GitOps deployments stopped
            - Cannot sync or manage applications

            **Action**:
            1. Check server pod: `kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server`
            2. Check server logs: `kubectl logs -n argocd -l app.kubernetes.io/name=argocd-server --tail=100`
            3. Check ingress: `kubectl get ingress -n argocd`
            4. Restart if needed: `kubectl rollout restart deployment -n argocd argocd-server`
        labels:
          severity: critical
          component: argocd
          category: platform
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: up{job="argocd-server-metrics"}
              refId: A
              datasource:
                type: prometheus
                uid: prometheus
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: B
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
              datasource:
                type: __expr__
                uid: __expr__
          - refId: C
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: math
              expression: $B == 0
              refId: C
              datasource:
                type: __expr__
                uid: __expr__
      - uid: argocdreposervererrors
        title: ArgoCDRepoServerErrors
        condition: C
        for: 10m
        noDataState: OK
        execErrState: Alerting
        annotations:
          summary: ArgoCD repo server experiencing errors
          description: >
            ArgoCD repo server is failing to connect to Git repositories.


            **Error rate**: {{ $value }} errors/second


            **Impact**: Cannot fetch latest manifests, deployments stalled.


            **Possible causes**:

            1. Git repository unreachable

            2. Authentication issues

            3. Network connectivity problems


            **Action**:

            1. Check repo-server logs: `kubectl logs -n argocd -l app.kubernetes.io/name=argocd-repo-server --tail=200`

            2. Test Git connectivity: `kubectl exec -n argocd -it deployment/argocd-repo-server -- git ls-remote
            <repo-url>`

            3. Verify credentials: `argocd repo list`
        labels:
          severity: warning
          component: argocd
          category: platform
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: rate(argocd_git_request_total{request_type="ls-remote",status_code!~"2.."}[5m])
              refId: A
              datasource:
                type: prometheus
                uid: prometheus
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: B
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
              datasource:
                type: __expr__
                uid: __expr__
          - refId: C
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: math
              expression: $B > 0.1
              refId: C
              datasource:
                type: __expr__
                uid: __expr__
      - uid: argocdapplicationdegraded
        title: ArgoCDApplicationDegraded
        condition: C
        for: 5m
        noDataState: OK
        execErrState: Alerting
        annotations:
          summary: ArgoCD application {{ $labels.name }} is degraded
          description: |
            Application {{ $labels.name }} health status is Degraded.

            **Impact**: Application may not be functioning correctly.

            **Action**:
            1. Check app details: `argocd app get {{ $labels.name }}`
            2. View resource health: `kubectl get all -n {{ $labels.dest_namespace }}`
            3. Check pod logs: `kubectl logs -n {{ $labels.dest_namespace }} -l app={{ $labels.name }} --tail=100`
            4. Review recent changes in ArgoCD UI
        labels:
          severity: warning
          component: argocd
          category: platform
        data:
          - refId: A
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: prometheus
            model:
              expr: argocd_app_info{health_status="Degraded"}
              refId: A
              datasource:
                type: prometheus
                uid: prometheus
              intervalMs: 1000
              maxDataPoints: 43200
          - refId: B
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
              datasource:
                type: __expr__
                uid: __expr__
          - refId: C
            relativeTimeRange:
              from: 0
              to: 0
            datasourceUid: __expr__
            model:
              type: math
              expression: $B > 0
              refId: C
              datasource:
                type: __expr__
                uid: __expr__
